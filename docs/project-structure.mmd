%% Swanytello - Project structure and architecture
%% Render at https://mermaid.live or in any Mermaid-compatible viewer

%% --- 1. Monolith architecture (high-level) ---
flowchart TB
  subgraph external [External]
    Frontends[Frontends]
    Systems[External systems]
    Users[Users]
  end

  subgraph monolith [Swanytello monolith]
    subgraph api [REST API]
      Fastify[Fastify]
      Routes[Routes / Controllers / Services / Models]
      Fastify --> Routes
    end

    subgraph rag [RAG]
      RAGLogic[RAG + LangChain]
    end

    subgraph channels [Channels]
      WhatsApp[WhatsApp]
      Discord[Discord]
    end

    subgraph etl [ETL]
      Extract[Extract]
      Transform[Transform]
      Load[Load]
    end

    subgraph shared [Shared]
      Log[log]
      Types[types]
      Utils[utils]
    end
  end

  Frontends --> api
  Systems --> api
  Users --> channels
  channels --> api
  channels --> rag
  etl --> rag
  api --> Log
  rag --> Log
  channels --> Log
  etl --> Log

%% --- 2. Folder structure (tree-style) ---
flowchart TB
  subgraph root [Project root]
    guardrails[guardrails/]
    prisma[prisma/]
    config[prisma.config.ts and package.json]
  end

  subgraph src_content [src/]
    server[server.ts]
    api[api/]
    rag[rag/]
    channels[channels/]
    etl[etl/]
    log[log/]
    types[types/]
    utils[utils/]
  end

  subgraph api_content [api/]
    routes[routes]
    controllers[controllers]
    services[services]
    models[models]
    schemas[schemas]
    middleware[middleware]
    plugins[plugins]
    fastify[fastifyInstance.ts]
  end

  subgraph channels_content [channels/]
    whatsapp[whatsapp/]
    discord[discord/]
  end

  root --> guardrails
  root --> prisma
  root --> config
  root --> src_content
  api --> api_content
  channels --> channels_content
